# [已废弃] ChatGPT to PDF 油猴脚本

⚠️ **重要提示：此脚本已废弃** ⚠️

由于ChatGPT界面频繁变更，此脚本已无法正常工作。脚本不再维护，建议用户卸载并寻找替代方案。

## 废弃原因

ChatGPT网站界面经常变更，导致脚本无法正确提取对话内容，造成：

1. 导出的PDF内容为空
2. 脚本无法正确识别对话元素
3. 格式转换失败

## 如何卸载

1. 点击浏览器中的Tampermonkey扩展图标
2. 选择"管理面板"
3. 找到"[已废弃] ChatGPT to PDF"脚本
4. 点击垃圾桶图标将其删除

## 寻找替代方案

您可以尝试以下方法将ChatGPT对话导出为PDF：

1. 使用浏览器的打印功能（Ctrl+P 或 Command+P）
2. 使用ChatGPT的官方导出功能（如果可用）
3. 寻找其他更新的浏览器扩展

---

以下是原脚本文档，仅供参考。请注意，脚本功能已不再可用。

## 原脚本功能

这是一个功能强大的油猴(Tampermonkey)脚本，用于将ChatGPT聊天记录导出为PDF文件，支持代码块和图片。

## 最新更新 (v0.7)

- 彻底重写PDF生成方法，解决PDF导出为空的问题
- 引入全新的内容提取策略，使用多种方法确保获取内容
- 添加jQuery支持，增强DOM处理能力
- 简化样式和布局，提高PDF可读性
- 使用专门的对话格式，清晰区分用户和ChatGPT消息
- 添加更强大的内容检查功能
- 改进图片和代码块处理方式

### 之前更新 (v0.6)

- 彻底重写内容提取逻辑，修复导出PDF为空的问题
- 直接定位并提取对话元素，不再依赖容器选择器
- 添加多种备用提取方法，确保总能获取到聊天内容
- 增强样式处理，强制使隐藏内容在PDF中可见
- 添加更详细的内容检查和错误处理
- 优化HTML渲染选项，提高内容完整性
- 添加内容状态日志，便于诊断问题

### 更早更新 (v0.5)

- 优化代码块识别和处理逻辑，支持更多代码块样式
- 改进聊天容器选择器，增加更多可能的选择器
- 增强消息识别能力，支持中英文用户标识
- 优化元素移除逻辑，更彻底地清理不需要的界面元素
- 添加更详细的日志记录，便于调试和问题排查
- 修复重复处理代码块的性能问题
- 改进PDF背景色设置，确保白色背景

## 功能

- 在ChatGPT页面添加"导出PDF"和"设置"按钮
- 一键将当前对话导出为PDF文件
- 完美支持代码块、表格、图片等复杂内容
- 保留对话的格式和样式
- 自动移除不必要的界面元素（如按钮、输入框等）
- 可自定义PDF设置（文件名、页面大小、方向等）
- 设置自动保存到浏览器本地存储

## 安装步骤

1. 首先，确保您的浏览器已安装Tampermonkey扩展
   - [Chrome版Tampermonkey](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo)
   - [Firefox版Tampermonkey](https://addons.mozilla.org/en-US/firefox/addon/tampermonkey/)
   - [Edge版Tampermonkey](https://microsoftedge.microsoft.com/addons/detail/tampermonkey/iikmkjmpaadaobahmlepeloendndfphd)

2. 安装此脚本
   - 点击Tampermonkey图标，选择"添加新脚本"
   - 将`chatgpt_to_pdf.user.js`文件的内容复制粘贴到编辑器中
   - 保存脚本（Ctrl+S或Command+S）

3. 或者，您也可以通过以下方式安装：
   - 将`chatgpt_to_pdf.user.js`文件拖放到浏览器中
   - Tampermonkey会自动检测并提示安装

## 使用方法

1. 访问[ChatGPT](https://chat.openai.com/)或其他ChatGPT网站
2. 进行正常对话
3. 当您想要保存对话时，点击页面右下角的"导出PDF"按钮
4. 浏览器将自动生成并下载PDF文件

## 自定义设置

点击页面右下角的"设置"按钮，可以自定义以下选项：

- **文件名**：设置导出PDF的文件名
- **页面大小**：选择A4、Letter或Legal格式
- **方向**：选择纵向或横向
- **包含时间戳**：是否在PDF中包含导出时间
- **包含标题**：是否在PDF中包含"ChatGPT 对话记录"标题

所有设置会自动保存到浏览器的本地存储中，下次使用时自动加载。

## 特殊内容支持

### 代码块

脚本对代码块进行了特殊处理，确保：
- 代码格式和语法高亮得到保留
- 长代码行会自动换行，不会被截断
- 保持代码的可读性和美观性
- 支持多种代码块样式和格式

### 图片

脚本会等待所有图片加载完成后再生成PDF，确保：
- 图片完整显示在PDF中
- 图片大小适应页面宽度
- 保持图片的清晰度

### 表格和其他格式化内容

脚本添加了专门的CSS样式，确保表格、列表、引用块等内容在PDF中正确显示。

## 常见问题解答

### 导出的PDF是空白的

如果您遇到导出的PDF是空白的问题，可以尝试以下解决方法：

1. **更新脚本至最新版本(v0.7+)**：最新版本完全重写了PDF生成逻辑，专门解决了PDF导出为空的问题
2. **刷新页面**：有时候ChatGPT的界面结构可能发生变化，刷新页面后重试
3. **确认在对话页面**：确保您在ChatGPT的对话页面，而不是设置或其他页面
4. **检查浏览器控制台**：按F12打开开发者工具，查看以`[ChatGPT to PDF]`开头的日志信息，可以帮助诊断问题
5. **禁用广告拦截器**：某些广告拦截器可能会干扰脚本功能，尝试暂时禁用

如果以上方法都不能解决问题，请提供控制台日志信息，我们将进一步调查。

### 找不到导出按钮

如果您在页面上找不到导出按钮，可能是因为：

1. **脚本未正确加载**：尝试刷新页面，或检查Tampermonkey是否已启用此脚本。
2. **按钮位置被覆盖**：在最新版本中，按钮位置已调整为页面右下角，距离底部80px的位置，避免与ChatGPT界面元素重叠。
3. **CSS冲突**：某些浏览器扩展或网站主题可能会影响按钮的显示，尝试禁用其他扩展后重试。

### 设置选项不起作用

如果您发现设置选项不起作用，可以尝试：

1. **清除浏览器缓存**：清除浏览器缓存和Cookie后重试。
2. **重置设置**：在浏览器控制台中执行以下命令重置设置：
   ```javascript
   localStorage.removeItem('chatgpt2pdf_settings');
   ```
3. **重新安装脚本**：卸载并重新安装脚本。

### 导出过程中浏览器卡顿

对于非常长的对话，导出过程可能需要较长时间，并可能导致浏览器暂时卡顿：

1. **分段导出**：尝试导出较短的对话，或者创建新的对话。
2. **关闭其他标签页**：导出前关闭其他不必要的浏览器标签页。
3. **调整图片质量**：如果对话中包含大量图片，可能会影响导出速度。

### 代码块格式不正确

如果导出的PDF中代码块格式不正确：

1. **检查原始格式**：确保ChatGPT中的代码块格式正确显示。
2. **尝试不同的浏览器**：某些浏览器可能对HTML渲染有所不同。
3. **更新脚本**：新版本可能修复了格式问题。

### 消息角色标识错误

如果您发现用户和ChatGPT的角色标识错误：

1. **检查最新版本**：确保使用最新版本的脚本，我们不断改进消息识别逻辑。
2. **提供反馈**：如果您发现特定情况下角色识别错误，请提供详细信息，帮助我们改进脚本。

### 控制台显示网络请求错误

如果您在控制台中看到类似以下错误：
```
POST https://eu.i.posthog.com/e/?retry_count=1&ip=1&_=1741467799586&ver=1.194.1&compression=gzip-js net::ERR_BLOCKED_BY_CLIENT
```

这些是ChatGPT网站的分析和跟踪请求，被浏览器的广告拦截器阻止了，与我们的脚本无关，不会影响PDF导出功能。

## 注意事项

- 此脚本仅在ChatGPT网页版上工作
- 对于非常长的对话，可能需要一些时间来生成PDF
- 某些复杂的格式可能在PDF中无法完美呈现
- 如果遇到问题，可以尝试刷新页面后重试

## 调试模式

如果您遇到问题需要更详细的错误信息，可以启用调试模式：

1. 打开浏览器控制台（F12）
2. 查看以`[ChatGPT to PDF]`开头的日志信息
3. 将这些信息提供给开发者以帮助解决问题

## 许可

MIT

## 贡献

欢迎提交问题和改进建议！如果您发现任何bug或有功能建议，请提交issue或pull request。 